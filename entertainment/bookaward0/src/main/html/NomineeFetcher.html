<!doctype html>
<html>
<head>
	<meta charset="utf-8">
	<title>Nominee Fetcher</title>

	<link rel="stylesheet" href="../css/style.css">

	<script src="../../../../../coreweb/lib/jquery/jquery-1.11.3.min.js"></script>
	<script src="../../../../../coreweb/lib/moment/moment.min-2.10.3.js"></script>
	<!-- <script src="../../../../../coreweb/lib/react/react-15.3.2.js"></script>
	<script src="../../../../../coreweb/lib/react-dom/react-dom-15.3.2.js"></script>
	<script src="../../../../../coreweb/lib/react-redux/react-redux-4.4.5.js"></script>
	<script src="../../../../../coreweb/lib/reactable/reactable-0.14.0.js"></script>
	<script src="../../../../../coreweb/lib/redux/redux-3.6.0.js"></script> -->
	<script src="../../../../../coreweb/lib/require/require-2.3.2.js" data-main="../../../src/main/js/Award"></script>

	<script src="../../../../../coreweb/src/main/js/util/Logger.js"></script>
	<script src="../../../../../coreweb/src/main/js/util/InputValidator.js"></script>
	<script src="../../../../../coreweb/src/main/js/util/ArrayAugments.js"></script>
	<script src="../../../../../coreweb/src/main/js/util/StringAugments.js"></script>

</head>
<body>
	<h1>Nominee Fetcher</h1>
	<div id="bookTablePanel"></div>
	<script>
		"use strict";

		var LOGGER = new Logger();
		LOGGER.setTraceEnabled(false);
		// LOGGER.setDebugEnabled(false);

		require(
			["Award", "process/OmniMysteryNomineeFetcher", "process/SYKMNomineeFetcher"],
			function(Award, OmniMysteryNomineeFetcher, SYKMNomineeFetcher) {
				var nominees = [];
				var count = 0;
				Award.values().forEach(function(awardKey) {
					// var awardKey = Award.BARRY;
					var award = Award.properties[awardKey];
					// var fetcher = new OmniMysteryNomineeFetcher(award, callback);
					var fetcher = new SYKMNomineeFetcher(award, callback);
					fetcher.fetchData();
				});

				function callback(newNominees) {
					nominees.vizziniAddAll(newNominees);
					count++;

					if (count === Award.values().length) {
						LOGGER.info("nominees.length = " + nominees.length);
						nominees.sort(function(a, b) {
							var answer = b.year() - a.year();

							if (answer === 0) {
								var aTitle = a.title();
								var bTitle = b.title();

								if (aTitle < bTitle) {
									answer = -1;
								} else if (aTitle > bTitle) {
									answer = 1;
								}
							}

							return answer;
						});
						var content = Award.values().reduce(function(previousValue, awardKey) {
							var awardString = "var " + awardKey + " = Award.properties." + awardKey + ";<br/>"
							return previousValue + awardString;
						}, "");
						content += nominees.reduce(function(previousValue, nominee) {
							var nomineeString = "this.nominees.push(new Nominee(";
							nomineeString += "\"" + nominee.title() + "\", ";
							nomineeString += "\"" + nominee.author() + "\", ";
							nomineeString += nominee.award().value + ", ";
							nomineeString += nominee.award().value + ".categories.properties." + nominee.category().value + ", ";
							nomineeString += nominee.year();
							nomineeString += "));<br/>";
							return previousValue + nomineeString;
						}, "");

						document.getElementById("bookTablePanel").innerHTML = content;
					}
				}
			});
	</script>
</body>

</html>
</body>

</html>
