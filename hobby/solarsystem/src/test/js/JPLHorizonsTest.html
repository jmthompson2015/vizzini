<!doctype html>
<html>
<head>
<meta charset="utf-8">
<title>JPLHorizonsTest</title>

<link rel="stylesheet"
	href="http://code.jquery.com/qunit/qunit-1.15.0.css">
<script src="http://code.jquery.com/qunit/qunit-1.15.0.js"></script>

<script
	src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>

<script src="../../../../../coreweb/lib/microevent/microevent-1.0.0.js"></script>

<script src="../../../../../coreweb/src/main/js/util/Logger.js"></script>
<script src="../../../../../coreweb/src/main/js/util/InputValidator.js"></script>
<script src="../../../../../coreweb/src/main/js/util/ArrayAugments.js"></script>
<script src="../../../../../coreweb/src/main/js/util/NumberAugments.js"></script>

<script src="../../main/js/Body.js"></script>
<script src="../../main/js/JPLHorizons.js"></script>
<script src="../../main/js/Vector.js"></script>

<script>
    "use strict";

    var LOGGER = new Logger();
    LOGGER.setTraceEnabled(false);

    QUnit.test("receiveData() Ceres", function(assert)
    {
        // Setup.
        var bodyKey = "ceres";
        var body = Body.properties[bodyKey];
        var horizons = new JPLHorizons(body);
        var textDocument = load("Ceres");

        // Run.
        horizons.receiveData(textDocument);

        // Verify.
        assert.equal(body.name, "Ceres");
        assert.equal(body.type, "dwarfPlanet");
        assert.equal(body.radius, 473);
        assert.equal(body.mass, 9.393E+20);
        assert.equal(body.position.getX(), 3.366338071991511E+08);
        assert.equal(body.position.getY(), -2.821504403698499E+08);
        assert.equal(body.position.getZ(), -7.084929304153316E+07);
        assert.equal(body.position.magnitude(), 444916636.5452977);
        assert.equal(body.velocity.getX(), 1.068623901762323E+01);
        assert.equal(body.velocity.getY(), 1.265716197859746E+01);
        assert.equal(body.velocity.getZ(), -1.572056902815111E+00);
        assert.equal(body.velocity.magnitude(), 16.639435585377132);
    });

    QUnit.test("receiveData() Earth", function(assert)
    {
        // Setup.
        var bodyKey = "earth";
        var body = Body.properties[bodyKey];
        var horizons = new JPLHorizons(body);
        var textDocument = load("Earth");

        // Run.
        horizons.receiveData(textDocument);

        // Verify.
        assert.equal(body.name, "Earth");
        assert.equal(body.type, "planet");
        assert.equal(body.radius, 6378.14);
        assert.equal(body.mass, 5.97219E+24);
        assert.equal(body.position.getX(), 1.207145030425360E+08);
        assert.equal(body.position.getY(), 8.753023039260490E+07);
        assert.equal(body.position.getZ(), -2.710966698286682E+04);
        assert.equal(body.position.magnitude(), 149109131.88776526);
        assert.equal(body.velocity.getX(), -1.799056283741665E+01);
        assert.equal(body.velocity.getY(), 2.398700106873661E+01);
        assert.equal(body.velocity.getZ(), -3.924793139749028E-04);
        assert.equal(body.velocity.magnitude(), 29.98393856104712);
    });

    QUnit.test("receiveData() Ganymede", function(assert)
    {
        // Setup.
        var bodyKey = "ganymede";
        var body = Body.properties[bodyKey];
        var horizons = new JPLHorizons(body);
        var textDocument = load("Ganymede");

        // Run.
        horizons.receiveData(textDocument);

        // Verify.
        assert.equal(body.name, "Ganymede");
        assert.equal(body.type, "moon");
        assert.equal(body.radius, 2634);
        assert.equal(body.mass, 1482E+20);
        assert.equal(body.position.getX(), -7.501770983329450E+08);
        assert.equal(body.position.getY(), 3.013765799846016E+08);
        assert.equal(body.position.getZ(), 1.547227811262196E+07);
        assert.equal(body.position.magnitude(), 808599352.7182955);
        assert.equal(body.velocity.getX(), -1.158628640881205E+00);
        assert.equal(body.velocity.getY(), -2.165454096878597E+01);
        assert.equal(body.velocity.getZ(), -1.720290026253046E-01);
        assert.equal(body.velocity.magnitude(), 21.686197427719883);
    });

    QUnit.test("receiveData() Luna", function(assert)
    {
        // Setup.
        var bodyKey = "luna";
        var body = Body.properties[bodyKey];
        var horizons = new JPLHorizons(body);
        var textDocument = load("Luna");

        // Run.
        horizons.receiveData(textDocument);

        // Verify.
        assert.equal(body.name, "Luna");
        assert.equal(body.type, "moon");
        assert.equal(body.radius, 1737.53);
        assert.equal(body.mass, 734.9E+20);
        assert.equal(body.position.getX(), 1.208378286083744E+08);
        assert.equal(body.position.getY(), 8.787641583075066E+07);
        assert.equal(body.position.getZ(), -5.854681981767714E+04);
        assert.equal(body.position.magnitude(), 149412344.56957024);
        assert.equal(body.velocity.getX(), -1.897326859058666E+01);
        assert.equal(body.velocity.getY(), 2.440074027424191E+01);
        assert.equal(body.velocity.getZ(), -3.847427515017365E-02);
        assert.equal(body.velocity.magnitude(), 30.909262806016613);
    });

    QUnit.test("receiveData() Mars", function(assert)
    {
        // Setup.
        var bodyKey = "mars";
        var body = Body.properties[bodyKey];
        var horizons = new JPLHorizons(body);
        var textDocument = load("Mars");

        // Run.
        horizons.receiveData(textDocument);

        // Verify.
        assert.equal(body.name, "Mars");
        assert.equal(body.type, "planet");
        assert.equal(body.radius, 3394.0);
        assert.equal(body.mass, 6.4185E+23);
        assert.equal(body.position.getX(), -2.069764485536530E+08);
        assert.equal(body.position.getY(), 1.373030923114634E+08);
        assert.equal(body.position.getZ(), 7.943484877974279E+06);
        assert.equal(body.position.magnitude(), 248504503.7140772);
        assert.equal(body.velocity.getX(), -1.244555563774038E+01);
        assert.equal(body.velocity.getY(), -1.813559956250841E+01);
        assert.equal(body.velocity.getZ(), -7.482155471513430E-02);
        assert.equal(body.velocity.magnitude(), 21.99539553835749);
    });

    QUnit.test("receiveData() Sol", function(assert)
    {
        // Setup.
        var bodyKey = "sol";
        var body = Body.properties[bodyKey];
        var horizons = new JPLHorizons(body);
        var textDocument = load("Sol");

        // Run.
        horizons.receiveData(textDocument);

        // Verify.
        assert.equal(body.name, "Sol");
        assert.equal(body.type, "star");
        assert.equal(body.radius, 6.963E+5);
        assert.equal(body.mass, 1.988544E+30);
        assert.equal(body.position.getX(), 5.480196755744247E+05);
        assert.equal(body.position.getY(), 1.459042012072013E+05);
        assert.equal(body.position.getZ(), -2.378316380790735E+04);
        assert.equal(body.position.magnitude(), 567608.3505616552);
        assert.equal(body.velocity.getX(), 2.571678800356398E-03);
        assert.equal(body.velocity.getY(), 1.150114948173457E-02);
        assert.equal(body.velocity.getZ(), -7.719474868883754E-05);
        assert.equal(body.velocity.magnitude(), 0.011785411757025336);
    });

    function load(bodyName)
    {
        var request = new XMLHttpRequest();
        var url = "../resources/" + bodyName + ".txt";
        var isAsync = false;
        request.open("GET", url, isAsync);
        request.send();

        //        LOGGER.info("request.responseText = " + request.responseText);

        return request.responseText;
    }
</script>
</head>
<body>
	<div id="qunit"></div>
</body>
</html>
