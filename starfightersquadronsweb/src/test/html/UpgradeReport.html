<!doctype html>
<html>
<head>
    <meta charset="utf-8">
    <title>Upgrade Report</title>

    <link rel="stylesheet" href="../../main/css/style.css">

    <script src="../../../../coreweb/lib/react/react-15.3.2.js"></script>
    <script src="../../../../coreweb/lib/react-dom/react-dom-15.3.2.js"></script>
    <script src="../../../../coreweb/lib/react-redux/react-redux-4.4.5.js"></script>
    <script src="../../../../coreweb/lib/reactable/reactable-0.14.0.js"></script>
    <script src="../../../../coreweb/lib/redux/redux-3.6.0.js"></script>
    <script src="../../../../coreweb/lib/require/require-2.3.2.js" data-main="../../main/js/Team"></script>

    <script src="../../../../coreweb/src/main/js/util/JavaScriptAugments.js"></script>
    <script src="../../../../coreweb/src/main/js/util/Logger.js"></script>
    <script src="../../../../coreweb/src/main/js/util/InputValidator.js"></script>
    <script src="../../../../coreweb/src/main/js/util/ArrayAugments.js"></script>
    <script src="../../../../coreweb/src/main/js/util/MathAugments.js"></script>

    <style>
        #upgradeTable {
            background-color: white;
            border-collapse: collapse;
            font-size: small;
        }

        #upgradeTable tbody tr:nth-child(2n) td {
            background: lightCyan;
        }

        #upgradeTable tbody tr:nth-child(2n+1) td {
            background: white;
        }

        #upgradeTable th {
            background-color: #555555;
            border: 1px solid lightGray;
            color: white;
        }

        #upgradeTable td {
            border: 1px solid lightGray;
        }

        .textCell {
            text-align: left;
        }

        .numberCell {
            text-align: right;
        }
    </style>
</head>
<body>
    <h1>Unimplemented Upgrades from Prefabricated SquadBuilders</h1>
    <div id="count"></div>
    <div id="panel"></div>
    <script>
        "use strict";
        var LOGGER = new Logger();
        LOGGER.setTraceEnabled(false);
        LOGGER.setDebugEnabled(false);

        var resourceBase = "https://raw.githubusercontent.com/jmthompson2015/vizzini/master/starfightersquadronsweb/src/main/resources/";
        var audioBase = resourceBase + "audio/";
        var iconBase = resourceBase + "icons/";
        var imageBase = resourceBase + "images/";

        require(["UpgradeCard", "process/SquadBuilder"], function(UpgradeCard, SquadBuilder)
        {
            var agent = {};
            var upgradeKeys = [];
            SquadBuilder.SquadBuilders.forEach(function(squadBuilder)
            {
                var squad = squadBuilder.buildSquad(agent);
                squad.forEach(function(token)
                {
                    var myUpgradeKeys;
                    if (token.tokenFore !== undefined)
                    {
                        myUpgradeKeys = token.tokenFore().upgradeKeys();
                        myUpgradeKeys.vizziniAddAll(token.tokenAft().upgradeKeys());
                    }
                    else
                    {
                        if (!token.upgradeKeys)
                        {
                            LOGGER.error("No upgradeKeys() for token = " + token);
                        }
                        myUpgradeKeys = token.upgradeKeys();
                    }
                    myUpgradeKeys.forEach(function(myUpgradeKey)
                    {
                        if (!upgradeKeys.vizziniContains(myUpgradeKey))
                        {
                            upgradeKeys.push(myUpgradeKey);
                        }
                    });
                });
            });

            upgradeKeys.sort();
            var upgradeRows = [];
            upgradeKeys.forEach(function(upgradeKey)
            {
                var upgrade = UpgradeCard.properties[upgradeKey];
                if (!upgrade.isImplemented)
                {
                    upgradeRows.push(upgrade);
                }
            });

            var UpgradeColumns = [
            {
                key: "type",
                label: "Type",
                className: "textCell",
            },
            {
                key: "name",
                label: "Name",
                className: "textCell",
            },
            {
                key: "restrictions",
                label: "Restrictions",
                className: "textCell",
            },
            {
                key: "header",
                label: "Header",
                className: "textCell",
            },
            {
                key: "description",
                label: "Description",
                className: "textCell",
            },
            {
                key: "squadPointCost",
                label: "Squad Point Cost",
                className: "numberCell",
            }, ];

            // Factories.
            var Table = React.createFactory(Reactable.Table);
            var Tr = React.createFactory(Reactable.Tr);
            var Td = React.createFactory(Reactable.Td);

            var rows = [];
            upgradeRows.forEach(function(upgradeRow)
            {
                var cells = [];
                for (var i = 0; i < UpgradeColumns.length; i++)
                {
                    cells.push(createCell(i, UpgradeColumns[i], upgradeRow[UpgradeColumns[i].key]));
                }
                rows.push(Tr(
                {
                    key: rows.length,
                }, cells));
            });

            ReactDOM.render(React.DOM.span(
            {}, upgradeRows.length), document.getElementById("count"));
            var element = Table(
            {
                id: "upgradeTable",
                columns: UpgradeColumns,
                sortable: true,
            }, rows);
            ReactDOM.render(element, document.getElementById("panel"));

            function createCell(key, column, value)
            {
                return Td(
                {
                    key: key,
                    className: column.className,
                    column: column.key,
                }, (value !== undefined ? value : ""));
            }
        });
    </script>
</body>

</html>
